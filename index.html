
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador De Not√≠cias Triad3</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .background {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #000 0%, #111 50%, #000 100%);
            z-index: -1;
        }

        .gradient-overlay {
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, rgba(6, 182, 212, 0.05) 0%, transparent 70%);
        }

        .glow-1 {
            position: absolute;
            top: 80px;
            right: 80px;
            width: 384px;
            height: 384px;
            background: rgba(6, 182, 212, 0.03);
            border-radius: 50%;
            filter: blur(60px);
        }

        .glow-2 {
            position: absolute;
            bottom: 160px;
            left: 80px;
            width: 320px;
            height: 320px;
            background: rgba(6, 182, 212, 0.02);
            border-radius: 50%;
            filter: blur(60px);
        }

        .header {
            position: relative;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 32px 20px 48px;
        }

        .logo {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 4px solid rgba(6, 182, 212, 0.4);
            box-shadow: 0 20px 40px rgba(6, 182, 212, 0.2);
        }

        .title {
            font-size: 3.5rem;
            font-weight: bold;
            color: #06b6d4;
            text-align: center;
            letter-spacing: -0.025em;
        }

        .container {
            position: relative;
            z-index: 10;
            max-width: 1024px;
            margin: 0 auto;
            padding: 0 20px 80px;
        }

        .subtitle-section {
            text-align: center;
            margin-bottom: 48px;
        }

        .subtitle {
            font-size: 1.875rem;
            font-weight: 600;
            color: #fff;
            margin-bottom: 16px;
        }

        .description {
            color: #d1d5db;
            font-size: 1.125rem;
        }

        .form-container {
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(6, 182, 212, 0.2);
            border-radius: 24px;
            padding: 48px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        .form-group {
            margin-bottom: 32px;
        }

        .label {
            display: block;
            color: #06b6d4;
            font-size: 1.125rem;
            font-weight: 500;
            margin-bottom: 16px;
        }

        .input, .textarea, .select {
            width: 100%;
            padding: 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-radius: 12px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input:focus, .textarea:focus, .select:focus {
            outline: none;
            border-color: #06b6d4;
            box-shadow: 0 0 0 4px rgba(6, 182, 212, 0.2);
            transform: scale(1.02);
        }

        .textarea {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .select {
            cursor: pointer;
        }

        .select option {
            background: #000;
            color: #fff;
            padding: 10px;
        }

        .phone-container {
            margin-bottom: 16px;
        }

        .phone-input-group {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
        }

        .phone-prefix {
            display: flex;
            align-items: center;
            padding: 0 20px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(6, 182, 212, 0.3);
            border-right: none;
            border-radius: 12px 0 0 12px;
            color: #06b6d4;
            font-weight: 500;
            font-size: 1rem;
        }

        .phone-input {
            flex: 1;
            border-radius: 0 12px 12px 0;
        }

        .remove-phone-btn {
            padding: 16px 20px;
            background: rgba(220, 38, 38, 0.8);
            color: #fff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            font-weight: 500;
        }

        .remove-phone-btn:hover {
            background: #dc2626;
            transform: scale(1.05);
        }

        .add-phone-btn {
            margin-top: 16px;
            padding: 12px 24px;
            background: rgba(6, 182, 212, 0.8);
            color: #fff;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .add-phone-btn:hover {
            background: #06b6d4;
            transform: scale(1.05);
        }

        .max-phones-notice {
            margin-top: 16px;
            padding: 16px;
            background: rgba(217, 119, 6, 0.2);
            border: 1px solid rgba(217, 119, 6, 0.4);
            border-radius: 12px;
            color: #fbbf24;
            text-align: center;
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .radio-option {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(6, 182, 212, 0.2);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: rgba(6, 182, 212, 0.5);
            background: rgba(6, 182, 212, 0.05);
        }

        .radio-option.selected {
            border-color: #06b6d4;
            background: rgba(6, 182, 212, 0.1);
        }

        .radio-circle {
            width: 24px;
            height: 24px;
            border: 2px solid rgba(6, 182, 212, 0.5);
            border-radius: 50%;
            margin-right: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .radio-option.selected .radio-circle {
            border-color: #06b6d4;
            background: #06b6d4;
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
        }

        .radio-dot {
            width: 12px;
            height: 12px;
            background: #000;
            border-radius: 50%;
            display: none;
        }

        .radio-option.selected .radio-dot {
            display: block;
        }

        .radio-text {
            color: #fff;
            font-size: 1.125rem;
        }

        .file-upload-section {
            margin-top: 24px;
            animation: slideInFromTop 0.3s ease-out;
        }

        .file-upload-btn {
            display: inline-block;
            padding: 16px 32px;
            background: linear-gradient(135deg, #06b6d4, #2563eb);
            color: #000;
            text-decoration: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.25);
        }

        .file-upload-btn:hover {
            background: linear-gradient(135deg, #0891b2, #1d4ed8);
            transform: scale(1.05);
        }

        .file-input {
            display: none;
        }

        .camera-section {
            margin-top: 24px;
            text-align: center;
            animation: slideInFromTop 0.3s ease-out;
        }

        .camera-view {
            width: 100%;
            max-width: 480px;
            border-radius: 12px;
            border: 2px solid rgba(6, 182, 212, 0.3);
            background: #000;
            transform: scaleX(-1); /* Mirror front camera */
        }

        .camera-controls {
            margin-top: 16px;
            display: flex;
            justify-content: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .camera-btn {
            padding: 16px 32px;
            background: linear-gradient(135deg, #06b6d4, #2563eb);
            color: #000;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.25);
        }
        
        .camera-btn:hover {
            transform: scale(1.05);
        }

        .camera-btn.secondary {
            background: rgba(0, 0, 0, 0.3);
            color: #06b6d4;
            border: 2px solid rgba(6, 182, 212, 0.3);
            box-shadow: none;
        }
        
        .image-bank-section {
            margin-top: 24px;
            animation: slideInFromTop 0.3s ease-out;
        }
        .image-bank-loader {
            text-align: center;
            color: #06b6d4;
            padding: 20px;
            font-size: 1.125rem;
        }
        .image-bank-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 16px;
            max-height: 400px;
            overflow-y: auto;
            padding: 8px;
            background: rgba(0,0,0,0.2);
            border-radius: 12px;
        }
        .bank-image-item {
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            aspect-ratio: 1 / 1;
        }
        .bank-image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .bank-image-item:hover {
            transform: scale(1.05);
            border-color: rgba(6, 182, 212, 0.5);
        }
        .bank-image-item.selected {
            border-color: #06b6d4;
            box-shadow: 0 0 20px rgba(6, 182, 212, 0.5);
            transform: scale(1.05);
        }
        .bank-image-item .overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.8rem;
            padding: 4px 8px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .image-preview {
            margin-top: 24px;
            text-align: center;
            animation: fadeIn 0.5s ease-out;
        }

        .preview-image {
            max-width: 100%;
            max-height: 256px;
            margin: 0 auto;
            border-radius: 12px;
            border: 2px solid rgba(6, 182, 212, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }

        .upload-success {
            margin-top: 16px;
            padding: 16px;
            background: rgba(6, 182, 212, 0.1);
            border-radius: 12px;
            color: #06b6d4;
        }

        .submit-btn {
            width: 100%;
            padding: 20px;
            border-radius: 12px;
            font-size: 1.25rem;
            font-weight: bold;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submit-btn.enabled {
            background: linear-gradient(135deg, #06b6d4, #2563eb);
            color: #000;
            box-shadow: 0 10px 25px rgba(6, 182, 212, 0.25);
        }

        .submit-btn.enabled:hover {
            background: linear-gradient(135deg, #0891b2, #1d4ed8);
            transform: scale(1.02);
        }

        .submit-btn.disabled {
            background: #4b5563;
            color: #9ca3af;
            cursor: not-allowed;
        }

        .progress-section {
            margin-top: 32px;
            text-align: center;
        }

        .progress-title {
            color: #06b6d4;
            font-weight: 500;
            margin-bottom: 12px;
        }

        .progress-bar-container {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 50px;
            padding: 4px;
            border: 1px solid rgba(6, 182, 212, 0.2);
        }

        .progress-bar {
            height: 12px;
            background: linear-gradient(135deg, #06b6d4, #2563eb);
            border-radius: 50px;
            transition: all 0.5s ease;
            box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
        }

        .progress-text {
            color: #d1d5db;
            font-size: 0.875rem;
            margin-top: 8px;
        }

        .modal {
            position: fixed;
            inset: 0;
            z-index: 50;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #06b6d4;
            border-radius: 24px;
            padding: 48px;
            max-width: 400px;
            width: 100%;
            margin: 0 20px;
            text-align: center;
            box-shadow: 0 25px 50px rgba(6, 182, 212, 0.2);
            animation: zoomIn 0.3s ease-out;
        }

        .rocket-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #06b6d4, #2563eb);
            border-radius: 50%;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            animation: pulse 2s infinite;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #06b6d4;
            margin-bottom: 16px;
        }

        .modal-text {
            color: #fff;
            font-size: 1.125rem;
            line-height: 1.7;
        }

        .hidden {
            display: none;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInFromTop {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes zoomIn {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 24px 20px;
            }

            .title {
                font-size: 2.5rem;
                line-height: 1.2;
            }
            
            .logo {
                position: static;
                transform: none;
                width: 80px;
                height: 80px;
            }
            
            .form-container {
                padding: 32px 24px;
            }
            
            .input, .textarea, .select {
                padding: 14px;
                font-size: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="background">
        <div class="gradient-overlay"></div>
        <div class="glow-1"></div>
        <div class="glow-2"></div>
    </div>

    <header class="header">
        <img src="https://aisfizoyfpcisykarrnt.supabase.co/storage/v1/object/public/imagens/LOGO%20TRIAD3%20.png" alt="NewBlog Triad3 Logo" class="logo">
        <h1 class="title">Gerador De Not√≠cias Triad3
</h1>
    </header>

    <div class="container">
        <div class="subtitle-section">
            <h2 class="subtitle">Crie conte√∫do profissional de forma instant√¢nea</h2>
            <p class="description"></p>
        </div>

        <form class="form-container" id="postForm">
            <!-- Tema da Postagem -->
            <div class="form-group">
                <label class="label">Qual √© o tema da postagem?</label>
                <input type="text" class="input" id="tema" placeholder="Ex: Marketing Digital, Tecnologia..." required>
            </div>

            <!-- Tom da Mensagem -->
            <div class="form-group">
                <label class="label">Tom da mensagem</label>
                <input type="text" class="input" id="tom" placeholder="Ex: Profissional, informal, engra√ßado..." required>
            </div>

            <!-- Regi√£o -->
            <div class="form-group">
                <label class="label">Regi√£o</label>
                <input type="text" class="input" id="regiao" placeholder="Ex: S√£o Paulo, Rio de Janeiro, Brasil..." required>
            </div>

            <!-- Objetivo da Postagem -->
            <div class="form-group">
                <label class="label">Descrever o objetivo da postagem</label>
                <textarea class="textarea" id="objetivo" placeholder="Descreva com detalhes o que espera da postagem..." required></textarea>
            </div>

            <!-- C√≥digo Postal e Telefones -->
            <div class="form-group">
                <label class="label">C√≥digo Postal e Telefones para Notifica√ß√£o</label>
                
                <!-- Seletor de C√≥digo Postal -->
                <div style="margin-bottom: 24px;">
                    <select class="select" id="codigoPostal">
                        <option value="+55">üáßüá∑ +55 - Brasil</option>
                        <option value="+1">üá∫üá∏ +1 - Estados Unidos</option>
                        <option value="+44">üá¨üáß +44 - Reino Unido</option>
                        <option value="+33">üá´üá∑ +33 - Fran√ßa</option>
                        <option value="+49">üá©üá™ +49 - Alemanha</option>
                        <option value="+34">üá™üá∏ +34 - Espanha</option>
                        <option value="+39">üáÆüáπ +39 - It√°lia</option>
                        <option value="+81">üáØüáµ +81 - Jap√£o</option>
                        <option value="+86">üá®üá≥ +86 - China</option>
                        <option value="+91">üáÆüá≥ +91 - √çndia</option>
                    </select>
                </div>

                <!-- Container de Telefones -->
                <div id="phonesContainer">
                    <div class="phone-container">
                        <div class="phone-input-group">
                            <div class="phone-prefix" id="phonePrefix">+55</div>
                            <input type="tel" class="input phone-input" placeholder="Digite o n√∫mero de telefone" required>
                        </div>
                    </div>
                </div>

                <!-- Bot√£o para adicionar telefone -->
                <button type="button" class="add-phone-btn" id="addPhoneBtn">+ Adicionar outro telefone (1/7)</button>
                
                <!-- Aviso de limite m√°ximo -->
                <div class="max-phones-notice hidden" id="maxPhonesNotice">
                    Limite m√°ximo de 7 telefones atingido
                </div>
            </div>

            <!-- Op√ß√µes de Imagem -->
            <div class="form-group">
                <label class="label">Voc√™ quer mandar uma imagem ou criar uma a partir da descri√ß√£o da postagem?</label>
                <div class="radio-group">
                    <div class="radio-option" data-value="mandar">
                        <div class="radio-circle"><div class="radio-dot"></div></div>
                        <span class="radio-text">Mandar uma imagem</span>
                    </div>
                    <div class="radio-option" data-value="tirar">
                        <div class="radio-circle"><div class="radio-dot"></div></div>
                        <span class="radio-text">Tirar foto</span>
                    </div>
                     <div class="radio-option" data-value="banco">
                        <div class="radio-circle"><div class="radio-dot"></div></div>
                        <span class="radio-text">Banco De Imagens</span>
                    </div>
                    <div class="radio-option" data-value="criar">
                        <div class="radio-circle"><div class="radio-dot"></div></div>
                        <span class="radio-text">Criar a partir da descri√ß√£o</span>
                    </div>
                </div>

                <!-- Se√ß√£o de Upload -->
                <div class="file-upload-section hidden" id="fileUploadSection">
                    <input type="file" class="file-input" id="imageUpload" accept="image/*">
                    <label for="imageUpload" class="file-upload-btn">Selecionar Imagem</label>
                </div>

                 <!-- Se√ß√£o da C√¢mera -->
                <div class="camera-section hidden" id="cameraSection">
                    <video id="videoElement" class="camera-view" playsinline autoplay muted></video>
                    <canvas id="canvasElement" class="hidden"></canvas>
                    <div class="camera-controls">
                        <button type="button" class="camera-btn" id="captureBtn">Tirar Foto</button>
                        <button type="button" class="camera-btn secondary" id="switchCameraBtn">Trocar C√¢mera</button>
                    </div>
                </div>

                <!-- Se√ß√£o do Banco de Imagens -->
                <div class="image-bank-section hidden" id="imageBankSection">
                    <div class="image-bank-loader" id="imageBankLoader"></div>
                    <div class="image-bank-grid" id="imageBankGrid"></div>
                </div>

                <!-- Preview da imagem -->
                <div class="image-preview hidden" id="imagePreview">
                    <img id="previewImg" class="preview-image" alt="Preview">
                    <div class="upload-success">‚úì Imagem selecionada com sucesso</div>
                </div>
            </div>

            <!-- Bot√£o de Envio -->
            <button type="submit" class="submit-btn disabled" id="submitBtn" disabled>Criar Postagem</button>

            <!-- Barra de Progresso -->
            <div class="progress-section">
                <div class="progress-title">Progresso do Formul√°rio</div>
                <div class="progress-bar-container">
                    <div class="progress-bar" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="progress-text" id="progressText">0 de 6 campos preenchidos</div>
            </div>
        </form>
    </div>

    <!-- Modal de Status -->
    <div class="modal hidden" id="statusModal">
        <div class="modal-content">
            <div class="rocket-icon">üöÄ</div>
            <h3 class="modal-title">Postagem em Cria√ß√£o</h3>
            <p class="modal-text">
                Sua postagem est√° sendo criada automaticamente.<br>
                Em instantes voc√™ ser√° notificado com o resultado!
            </p>
        </div>
    </div>

    <script>
        // Estado do formul√°rio
        let formData = {
            tema: '',
            tom: '',
            objetivo: '',
            regiao: '',
            imagemOpcao: '',
            telefones: [''],
            codigoPostal: '+55'
        };
        let selectedImageBase64 = null;
        let selectedImageUrl = null;
        let imageBankCache = null;
        let phoneCount = 1;
        let cameraStream = null;
        let currentFacingMode = 'user'; // 'user' para frontal, 'environment' para traseira

        // Elementos do DOM
        const form = document.getElementById('postForm');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progressBar');
        const progressText = document.getElementById('progressText');
        const statusModal = document.getElementById('statusModal');
        const phonesContainer = document.getElementById('phonesContainer');
        const addPhoneBtn = document.getElementById('addPhoneBtn');
        const maxPhonesNotice = document.getElementById('maxPhonesNotice');
        const phonePrefix = document.getElementById('phonePrefix');
        const codigoPostalSelect = document.getElementById('codigoPostal');
        const fileUploadSection = document.getElementById('fileUploadSection');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const previewImg = document.getElementById('previewImg');
        const cameraSection = document.getElementById('cameraSection');
        const videoElement = document.getElementById('videoElement');
        const canvasElement = document.getElementById('canvasElement');
        const captureBtn = document.getElementById('captureBtn');
        const switchCameraBtn = document.getElementById('switchCameraBtn');
        const imageBankSection = document.getElementById('imageBankSection');
        const imageBankLoader = document.getElementById('imageBankLoader');
        const imageBankGrid = document.getElementById('imageBankGrid');


        // --- Fun√ß√£o para redimensionar Imagem ---
        async function resizeImage(base64Str, width = 1080, height = 1080) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = base64Str;
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');

                    const sourceWidth = img.width;
                    const sourceHeight = img.height;
                    const sourceRatio = sourceWidth / sourceHeight;
                    const targetRatio = width / height;

                    let sx = 0, sy = 0, sWidth = sourceWidth, sHeight = sourceHeight;
                    
                    if (sourceRatio > targetRatio) {
                        sWidth = sourceHeight * targetRatio;
                        sx = (sourceWidth - sWidth) / 2;
                    } else if (sourceRatio < targetRatio) {
                        sHeight = sourceWidth / targetRatio;
                        sy = (sourceHeight - sHeight) / 2;
                    }

                    ctx.drawImage(img, sx, sy, sWidth, sHeight, 0, 0, width, height);
                    const resizedBase64 = canvas.toDataURL('image/jpeg', 0.9);
                    resolve(resizedBase64);
                };
                img.onerror = (error) => {
                    console.error("Erro ao carregar imagem para redimensionamento:", error);
                    reject("N√£o foi poss√≠vel carregar a imagem.");
                };
            });
        }


        // Fun√ß√£o para atualizar o progresso
        function updateProgress() {
            let filledFields = 0;
            
            if (document.getElementById('tema').value.trim()) filledFields++;
            if (document.getElementById('tom').value.trim()) filledFields++;
            if (document.getElementById('objetivo').value.trim()) filledFields++;
            if (document.getElementById('regiao').value.trim()) filledFields++;
            if (formData.imagemOpcao) {
                if (formData.imagemOpcao === 'criar' || selectedImageBase64 || selectedImageUrl) {
                    filledFields++;
                }
            }
            if (document.querySelector('.phone-input').value.trim()) filledFields++;
            
            const percentage = (filledFields / 6) * 100;
            progressBar.style.width = percentage + '%';
            progressText.textContent = `${filledFields} de 6 campos preenchidos`;
            
            const isComplete = filledFields === 6;
            if (isComplete) {
                submitBtn.classList.remove('disabled');
                submitBtn.classList.add('enabled');
                submitBtn.disabled = false;
            } else {
                submitBtn.classList.add('disabled');
                submitBtn.classList.remove('enabled');
                submitBtn.disabled = true;
            }
            
            return isComplete;
        }

        // Event listeners para campos de texto
        ['tema', 'tom', 'objetivo', 'regiao'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                formData[id] = e.target.value;
                updateProgress();
            });
        });

        // Event listener para c√≥digo postal
        codigoPostalSelect.addEventListener('change', (e) => {
            formData.codigoPostal = e.target.value;
            phonePrefix.textContent = e.target.value;
            
            document.querySelectorAll('.phone-prefix').forEach(prefix => {
                prefix.textContent = e.target.value;
            });
        });
        
        // --- Fun√ß√µes da C√¢mera ---
        function stopCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
                videoElement.srcObject = null;
            }
        }

        async function startCamera() {
            stopCamera();
            try {
                const constraints = { video: { facingMode: currentFacingMode } };
                cameraStream = await navigator.mediaDevices.getUserMedia(constraints);
                videoElement.srcObject = cameraStream;
                videoElement.style.transform = currentFacingMode === 'user' ? 'scaleX(-1)' : 'scaleX(1)';
                
                imagePreview.classList.add('hidden');
                selectedImageBase64 = null;
                selectedImageUrl = null;
                cameraSection.classList.remove('hidden');
                updateProgress();
            } catch (err) {
                console.error("Erro ao acessar a c√¢mera: ", err);
                alert("N√£o foi poss√≠vel acessar a c√¢mera. Verifique as permiss√µes do seu navegador e recarregue a p√°gina.");
                const tirarOption = document.querySelector('.radio-option[data-value="tirar"]');
                if (tirarOption) tirarOption.classList.remove('selected');
                formData.imagemOpcao = '';
                cameraSection.classList.add('hidden');
                updateProgress();
            }
        }

        captureBtn.addEventListener('click', async () => {
            if (!cameraStream) return;
            
            canvasElement.width = videoElement.videoWidth;
            canvasElement.height = videoElement.videoHeight;
            const context = canvasElement.getContext('2d');

            if (currentFacingMode === 'user') {
                context.translate(canvasElement.width, 0);
                context.scale(-1, 1);
            }
            
            context.drawImage(videoElement, 0, 0, canvasElement.width, canvasElement.height);
            const originalBase64 = canvasElement.toDataURL('image/jpeg');

            stopCamera();
            cameraSection.classList.add('hidden');

            try {
                const resizedBase64 = await resizeImage(originalBase64, 1080, 1080);
                selectedImageBase64 = resizedBase64;
                selectedImageUrl = null;
                previewImg.src = selectedImageBase64;
                imagePreview.classList.remove('hidden');
            } catch (error) {
                 alert('Falha ao processar a foto. Por favor, tente novamente.');
                console.error(error);
                selectedImageBase64 = null;
                imagePreview.classList.add('hidden');
            }
            
            updateProgress();
        });

        switchCameraBtn.addEventListener('click', () => {
            currentFacingMode = currentFacingMode === 'user' ? 'environment' : 'user';
            startCamera();
        });

        // --- Fun√ß√µes do Banco de Imagens ---
        async function loadImageBank() {
            if (imageBankCache) {
                renderImageBank(imageBankCache);
                return;
            }

            imageBankLoader.textContent = "Carregando imagens...";
            imageBankLoader.classList.remove('hidden');
            imageBankGrid.innerHTML = '';

            try {
                const response = await fetch('https://webhook.triad3.io/webhook/bancodeimagensbetoaguia', {
                    method: 'POST'
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const images = await response.json();
                imageBankCache = images;
                renderImageBank(images);
            } catch (error) {
                console.error('Erro ao carregar o banco de imagens:', error);
                imageBankLoader.textContent = 'Vazio';
            }
        }

        function renderImageBank(images) {
            imageBankLoader.classList.add('hidden');
            imageBankGrid.innerHTML = '';
            images.forEach(imgData => {
                const item = document.createElement('div');
                item.className = 'bank-image-item';
                item.dataset.imageUrl = imgData.imagem;
                
                const img = document.createElement('img');
                img.src = imgData.imagem;
                img.alt = imgData.nome;
                
                const overlay = document.createElement('div');
                overlay.className = 'overlay';
                overlay.textContent = imgData.nome;

                item.appendChild(img);
                item.appendChild(overlay);

                item.addEventListener('click', () => {
                    document.querySelectorAll('.bank-image-item.selected').forEach(el => el.classList.remove('selected'));
                    item.classList.add('selected');
                    
                    selectedImageUrl = imgData.imagem;
                    selectedImageBase64 = null;

                    previewImg.src = selectedImageUrl;
                    imagePreview.classList.remove('hidden');
                    updateProgress();
                });

                imageBankGrid.appendChild(item);
            });
        }

        // Event listeners para op√ß√µes de r√°dio (imagem)
        document.querySelectorAll('.radio-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                formData.imagemOpcao = option.getAttribute('data-value');
                
                // Reset states
                stopCamera();
                selectedImageBase64 = null;
                selectedImageUrl = null;
                imagePreview.classList.add('hidden');
                
                fileUploadSection.classList.add('hidden');
                cameraSection.classList.add('hidden');
                imageBankSection.classList.add('hidden');
                
                if (formData.imagemOpcao === 'mandar') {
                    fileUploadSection.classList.remove('hidden');
                    imageUpload.value = '';
                } else if (formData.imagemOpcao === 'tirar') {
                    startCamera();
                } else if (formData.imagemOpcao === 'banco') {
                    imageBankSection.classList.remove('hidden');
                    loadImageBank();
                }
                
                updateProgress();
            });
        });

        // Event listener para upload de imagem
        imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                if (!file.type.startsWith('image/')) {
                    alert('Por favor, selecione apenas arquivos de imagem.');
                    return;
                }
                if (file.size > 15 * 1024 * 1024) { // Increased size limit
                    alert('A imagem deve ter no m√°ximo 15MB.');
                    return;
                }
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try {
                        const originalBase64 = e.target.result;
                        const resizedBase64 = await resizeImage(originalBase64, 1080, 1080);
                        
                        selectedImageBase64 = resizedBase64;
                        selectedImageUrl = null;
                        previewImg.src = selectedImageBase64;
                        imagePreview.classList.remove('hidden');
                        updateProgress();
                    } catch (error) {
                        alert('Falha ao redimensionar a imagem. Por favor, tente outra imagem.');
                        console.error(error);
                    }
                };
                reader.readAsDataURL(file);
            }
        });

        // Fun√ß√£o para adicionar telefone
        function addPhone() {
            if (phoneCount < 7) {
                phoneCount++;
                const phoneContainer = document.createElement('div');
                phoneContainer.className = 'phone-container';
                phoneContainer.innerHTML = `
                    <div class="phone-input-group">
                        <div class="phone-prefix">${formData.codigoPostal}</div>
                        <input type="tel" class="input phone-input" placeholder="Digite o n√∫mero de telefone">
                        <button type="button" class="remove-phone-btn" onclick="removePhone(this)">Remover</button>
                    </div>
                `;
                phonesContainer.appendChild(phoneContainer);
                
                const newInput = phoneContainer.querySelector('.phone-input');
                newInput.addEventListener('input', updateProgress);
                
                updatePhoneButtons();
            }
        }

        // Fun√ß√£o para remover telefone
        function removePhone(button) {
            if (phoneCount > 1) {
                button.closest('.phone-container').remove();
                phoneCount--;
                updatePhoneButtons();
                updateProgress();
            }
        }

        // Fun√ß√£o para atualizar bot√µes de telefone
        function updatePhoneButtons() {
            addPhoneBtn.textContent = `+ Adicionar outro telefone (${phoneCount}/7)`;
            
            if (phoneCount >= 7) {
                addPhoneBtn.classList.add('hidden');
                maxPhonesNotice.classList.remove('hidden');
            } else {
                addPhoneBtn.classList.remove('hidden');
                maxPhonesNotice.classList.add('hidden');
            }
        }

        addPhoneBtn.addEventListener('click', addPhone);
        document.querySelector('.phone-input').addEventListener('input', updateProgress);

        // Event listener para o formul√°rio
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!updateProgress()) {
                alert('Por favor, preencha todos os campos obrigat√≥rios.');
                return;
            }

            if ((formData.imagemOpcao === 'mandar' || formData.imagemOpcao === 'tirar' || formData.imagemOpcao === 'banco') && !selectedImageBase64 && !selectedImageUrl) {
                alert('Por favor, selecione uma imagem ou escolha a op√ß√£o "Criar a partir da descri√ß√£o".');
                return;
            }

            const telefones = Array.from(document.querySelectorAll('.phone-input'))
                .map(input => input.value.trim())
                .filter(tel => tel);

            const payload = {
                tema: formData.tema,
                tom: formData.tom,
                objetivo: formData.objetivo,
                regiao: formData.regiao,
                imagem_opcao: formData.imagemOpcao,
                telefones: telefones,
                codigo_postal: formData.codigoPostal
            };

            if (formData.imagemOpcao === 'banco' && selectedImageUrl) {
                payload.imagem_url = selectedImageUrl;
            } else if ((formData.imagemOpcao === 'mandar' || formData.imagemOpcao === 'tirar') && selectedImageBase64) {
                payload.imagem_base64 = selectedImageBase64;
            }

            statusModal.classList.remove('hidden');

            try {
                const response = await fetch('https://webhook.triad3.io/webhook/blog-beto-aguiapostagens00234', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                console.log('Dados enviados:', payload);
                console.log('Status da resposta:', response.status);

                setTimeout(() => {
                    form.reset();
                    formData = {
                        tema: '', tom: '', objetivo: '', regiao: '',
                        imagemOpcao: '', telefones: [''], codigoPostal: '+55'
                    };
                    selectedImageBase64 = null;
                    selectedImageUrl = null;
                    
                    document.querySelectorAll('.radio-option').forEach(opt => opt.classList.remove('selected'));
                    fileUploadSection.classList.add('hidden');
                    cameraSection.classList.add('hidden');
                    imageBankSection.classList.add('hidden');
                    imagePreview.classList.add('hidden');
                    stopCamera();
                    
                    phoneCount = 1;
                    phonesContainer.innerHTML = `
                        <div class="phone-container">
                            <div class="phone-input-group">
                                <div class="phone-prefix" id="phonePrefix">+55</div>
                                <input type="tel" class="input phone-input" placeholder="Digite o n√∫mero de telefone" required>
                            </div>
                        </div>
                    `;
                    document.querySelector('.phone-input').addEventListener('input', updateProgress);
                    updatePhoneButtons();
                    
                    statusModal.classList.add('hidden');
                    updateProgress();
                }, 5000);

            } catch (error) {
                console.error('Erro ao enviar dados:', error);
                statusModal.classList.add('hidden');
                alert('Erro ao enviar dados. Tente novamente.');
            }
        });

        // Inicializa o progresso
        updateProgress();
    </script>
</body>
</html>